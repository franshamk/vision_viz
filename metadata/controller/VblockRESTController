{
    "type": "Ext.app.Controller",
    "reference": {
        "name": "items",
        "type": "array"
    },
    "codeClass": null,
    "userConfig": {
        "visionURL": "https://fm-sim-nimsoft.internal.superna.net:8443",
        "visionUser": "admin",
        "visionPass": "dangerous",
        "designer|userClassName": "VblockRESTController"
    },
    "designerId": "45e13f6d-91c7-4914-ac82-4fd329a935b7",
    "customConfigs": [
        {
            "group": "(Custom Properties)",
            "name": "visionURL",
            "type": "string"
        },
        {
            "group": "(Custom Properties)",
            "name": "visionUser",
            "type": "string"
        },
        {
            "group": "(Custom Properties)",
            "name": "visionPass",
            "type": "string"
        }
    ],
    "cn": [
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "getServiceTicketAndResource",
                "designer|params": [
                    "url"
                ],
                "implHandler": [
                    "var me = this;\r",
                    "\r",
                    "alert(\"getting service ticket\");\r",
                    "\r",
                    "// need to wait until a ticket granting ticket exists. \r",
                    "if(!me.ticketGrantingTicket) {\r",
                    "    Ext.defer(me.fetchVBlockXML, 50, this);\r",
                    "    return;\r",
                    "}\r",
                    "\r",
                    "alert (\"got service ticket, getting aontoher ciket\")\r",
                    "alert(me.ticketGrantingTicket);\r",
                    "\r",
                    "// NExt, get a service ticket. \r",
                    "Ext.Ajax.request({\r",
                    "    method: 'POST',\r",
                    "    url: me.ticketGrantingTicket,\r",
                    "    params: {\r",
                    "        service: me.config.visionURL + url\r",
                    "    },\r",
                    "    useDefaultXhrHeader: false,\r",
                    "    success: function(data) {        \r",
                    "        alert(data.responseText); \r",
                    "        // fetch the resource on success.\r",
                    "\t\tme.getResource(url, data.responseText);\r",
                    "    }\r",
                    "});\r",
                    "\r",
                    ""
                ]
            },
            "designerId": "32af46b9-416e-4e9a-bd57-eeb207e5e994"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "getResource",
                "designer|params": [
                    "url, ticket"
                ],
                "implHandler": [
                    "\r",
                    "alert(\"getting respource\");\r",
                    "url = this.config.visionURL + url;\r",
                    "\r",
                    "if(ticket) {\r",
                    "    url = url +\"?ticket=\" + ticket;\r",
                    "}\r",
                    "\r",
                    "var me = this;\r",
                    "Ext.Ajax.request({\r",
                    "    method: 'GET',\r",
                    "    url: url,\r",
                    "    useDefaultXhrHeader: false,\r",
                    "    success: function(data) {        \r",
                    "        alert(data.responseText); \r",
                    "    }\r",
                    "});\r",
                    ""
                ]
            },
            "designerId": "2883a432-e746-4858-bea2-0380aa8011d1"
        },
        {
            "type": "basicfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "doLogin",
                "implHandler": [
                    "var me = this;\r",
                    "\r",
                    "var cas = me.config.visionURL + \"/cas/v1/tickets\";\r",
                    "var base = \"/fm\";\r",
                    "\r",
                    "\r",
                    "Ext.Ajax.request({\r",
                    "    method: 'POST',\r",
                    "    url: cas,\r",
                    "    params: {\r",
                    "        username: me.config.visionUser,\r",
                    "        password: me.config.visionPass\r",
                    "    },\r",
                    "    useDefaultXhrHeader: false,\r",
                    "    success: function(data) {        \r",
                    "        var el = document.createElement('div');\r",
                    "        el.innerHTML = data.responseText;        \r",
                    "        var list = el.getElementsByTagName('form');\r",
                    "        me.ticketGrantingTicket = list[0].action;\r",
                    "        me.getServiceTicketAndResource(base);\r",
                    "    }\r",
                    "});"
                ]
            },
            "designerId": "af3cbfd9-bd02-4afe-af3b-12f59bc65849"
        },
        {
            "type": "fixedfunction",
            "reference": {
                "name": "items",
                "type": "array"
            },
            "codeClass": null,
            "userConfig": {
                "fn": "init",
                "designer|params": [
                    "application"
                ],
                "implHandler": [
                    "this.doLogin();"
                ]
            },
            "designerId": "81465ace-cf52-4455-88d6-138ceb7cf159"
        }
    ]
}